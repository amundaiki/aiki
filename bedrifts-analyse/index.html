<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Bedriftsanalyse - AIKI</title>
    <link rel="icon" type="image/png" href="https://images.squarespace-cdn.com/content/v1/67a10d12887082593bb5d293/d39dc0a0-5a17-4ef9-88a4-2d0edb45fd5e/LOGO+l.png?format=500w">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- AIKI Shared Styles -->
    <link rel="stylesheet" href="../assets/css/aiki-theme.css">
    
    <!-- Global Configuration -->
    <script src="../config.js"></script>
    <script src="../assets/js/aiki-common.js"></script>
</head>
<body>
    <div class="page-container">
        <div class="aiki-container" style="max-width: 600px;">
            <div class="aiki-header-home">
                <a href="../" style="text-decoration: none; color: inherit;">
                    <img src="https://images.squarespace-cdn.com/content/v1/67a10d12887082593bb5d293/d39dc0a0-5a17-4ef9-88a4-2d0edb45fd5e/LOGO+l.png?format=500w" alt="AIKI logo" class="header-logo" style="max-width: 80px;" />
                </a>
                <h1>AI Bedriftsanalyse</h1>
                <p>Analyser detaljert informasjon om bedrifter og leads</p>
                <a href="../" class="back-link" style="color: rgba(255,255,255,0.8); text-decoration: none; font-size: 14px; margin-top: 10px; display: inline-block;">
                    <i class="fas fa-arrow-left"></i> Tilbake til hovedsiden
                </a>
            </div>
            
            <div class="aiki-content">
                <form class="ai-form" id="bedriftinfoForm">
                    <div class="form-group">
                        <label for="bedriftNavn">Bedriftsnavn *</label>
                        <input type="text" id="bedriftNavn" name="navn" required placeholder="Navn på bedrift å analysere">
                    </div>
                    
                    <div class="form-group">
                        <label for="bedriftOrgnr">Organisasjonsnummer</label>
                        <input type="text" id="bedriftOrgnr" name="orgnr" placeholder="123456789" pattern="[0-9]{9}" maxlength="9">
                        <small style="color: var(--color-gray-medium); font-size: 12px;">Valgfritt - hjelper med nøyaktig identifikasjon</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="analyseFokus">Analysefokus *</label>
                        <select id="analyseFokus" name="fokus" required>
                            <option value="">Velg fokusområde</option>
                            <option value="økonomisk">Økonomisk analyse (årsregnskap, lønnsomhet)</option>
                            <option value="teknologi">Teknologistack og digitalisering</option>
                            <option value="marked">Markedsposisjon og konkurrenter</option>
                            <option value="vekst">Vekstpotensial og muligheter</option>
                            <option value="risiko">Risikoanalyse og stabilitet</option>
                            <option value="komplett">Komplett analyse (alle områder)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="analyseDybde">Analysedybde</label>
                        <select id="analyseDybde" name="dybde">
                            <option value="grunnleggende">Grunnleggende oversikt</option>
                            <option value="detaljert">Detaljert analyse</option>
                            <option value="avansert">Avansert dybdeanalyse</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="analyseFormål">Formål med analysen</label>
                        <select id="analyseFormål" name="formål">
                            <option value="">Ikke spesifisert</option>
                            <option value="salg">Salgs- og markedsføringsprosess</option>
                            <option value="partnerskap">Potensielt partnerskap</option>
                            <option value="konkurranse">Konkurranseanalyse</option>
                            <option value="investering">Investeringsvurdering</option>
                            <option value="leverandør">Leverandørvurdering</option>
                            <option value="kunde">Kundeutvikling</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="analysePeriode">Tidsperiode for analyse</label>
                        <select id="analysePeriode" name="periode">
                            <option value="siste-år">Siste år</option>
                            <option value="3-år">Siste 3 år</option>
                            <option value="5-år">Siste 5 år</option>
                            <option value="historisk">Komplett historikk</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="analyseSpesielt">Spesielle områder å fokusere på</label>
                        <textarea id="analyseSpesielt" name="spesielt" placeholder="F.eks. bærekraft, internasjonalisering, digital transformasjon, ledelse..." rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="analyseKontakt">Din e-post *</label>
                        <input type="email" id="analyseKontakt" name="kontakt" required placeholder="din@epost.no">
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-full btn-large">
                        <i class="fas fa-chart-bar"></i>
                        <span>Generer Bedriftsanalyse</span>
                    </button>
                </form>

                <div id="bedriftinfoResult" class="result-container" style="display: none;">
                    <h3><i class="fas fa-check-circle"></i> Bedriftsanalyse Fullført!</h3>
                    <div id="bedriftinfoContent" class="result-content"></div>
                    <div id="webhookResponse" class="result-content" style="margin-top: 10px; font-size: 12px; color: var(--color-gray-medium); display: none;"></div>
                    <div style="margin-top: 20px; text-align: center;">
                        <button onclick="downloadAnalyse()" class="btn btn-secondary btn-large">
                            <i class="fas fa-download"></i> <span>Last ned som PDF</span>
                        </button>
                        <button onclick="emailAnalyse()" class="btn btn-secondary btn-large" style="margin-left: 10px;">
                            <i class="fas fa-envelope"></i> <span>Send på e-post</span>
                        </button>
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: #e8f4fd; border-radius: 8px; border: 1px solid #b8daff;">
                        <p style="margin: 0; font-size: 14px; color: #004085;">
                            <i class="fas fa-info-circle"></i> 
                            <strong>Data kilder:</strong> Proff.no, offentlige registre, web-analyse og AI-inferens.
                        </p>
                    </div>
                </div>

                <!-- Info-seksjon -->
                <div style="margin-top: var(--spacing-xl); padding: var(--spacing-md); background: var(--color-gray-light); border-radius: var(--radius-md); text-align: center;">
                    <p style="font-size: var(--font-size-small); color: var(--color-gray-medium); margin-bottom: var(--spacing-sm);">
                        <i class="fas fa-info-circle"></i> Bedriftsanalysen tar typisk 45-90 sekunder
                    </p>
                    <p style="font-size: var(--font-size-small); color: var(--color-gray-medium);">
                        <strong>Support:</strong> amund@aiki.as | <strong>Web:</strong> www.aiki.as
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Modules JavaScript -->
    <script src="../ai-modules.js"></script>
    
    <script>
        // Initialize AIKI Bedriftsanalyse
        document.addEventListener('DOMContentLoaded', function() {
            const aiProcessor = new AIKIProcessor();
            let generatedAnalyse = '';

            document.getElementById('bedriftinfoForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const btn = this.querySelector('button[type="submit"]');
                const result = document.getElementById('bedriftinfoResult');
                const content = document.getElementById('bedriftinfoContent');
                
                // Loading state
                btn.innerHTML = '<div class="aiki-loading"></div> AI analyserer bedrift...';
                btn.disabled = true;
                
                try {
                    const formData = AIKI.forms.getData(this);
                    
                    // Send til konfigurert webhook (Make.com)
                    const webhookUrl = AIKI.getConfig('api.endpoints.makeWebhook', 'https://hook.eu2.make.com/pvfoqf3axkcz3wisaj7ogf18n28zuxxb');
                    const webhookResponse = await fetch(webhookUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            type: 'bedriftsanalyse_request',
                            data: formData,
                            timestamp: new Date().toISOString()
                        })
                    });
                    
                    // Forsøk å lese responsinnhold
                    const webhookStatus = webhookResponse.status;
                    const webhookOk = webhookResponse.ok;
                    let webhookBodyText = '';
                    
                    try {
                        const contentType = webhookResponse.headers.get('content-type') || '';
                        if (contentType.includes('application/json')) {
                            const json = await webhookResponse.json();
                            webhookBodyText = JSON.stringify(json);
                        } else {
                            webhookBodyText = await webhookResponse.text();
                        }
                    } catch (e) {
                        webhookBodyText = '';
                    }
                    
                    const webhookBox = document.getElementById('webhookResponse');
                    if (webhookBox) {
                        webhookBox.style.display = 'block';
                        webhookBox.innerHTML = `<div style="padding:10px;border:1px dashed var(--color-gray-border);border-radius:6px;background:#fafafa;">
                            <strong>Webhook status:</strong> ${webhookStatus} ${webhookOk ? '(OK)' : '(Feil)'}<br/>
                            ${webhookBodyText ? `<strong>Respons:</strong> <code style="white-space:pre-wrap;">${webhookBodyText}</code>` : '<em>Ingen responsinnhold</em>'}
                        </div>`;
                    }
                    
                    // Generate AI bedriftsanalyse
                    const analyse = await aiProcessor.generateBedriftInfo(formData);
                    generatedAnalyse = analyse;
                    
                    content.textContent = analyse;
                    result.style.display = 'block';
                    
                    // Smooth scroll to result
                    result.scrollIntoView({ behavior: 'smooth' });
                    
                    AIKI.logger.success('Bedriftsanalyse generated successfully');
                    
                } catch (error) {
                    content.innerHTML = `
                        <div style="color: var(--error-red); text-align: center; padding: 20px;">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>Beklager! Noe gikk galt med bedriftsanalysen.</p>
                            <p style="font-size: 14px; opacity: 0.8;">Prøv igjen om litt eller kontakt support.</p>
                        </div>
                    `;
                    result.style.display = 'block';
                    AIKI.logger.error('Bedriftsanalyse generation error:', error);
                } finally {
                    btn.innerHTML = '<i class="fas fa-chart-bar"></i> <span>Generer Bedriftsanalyse</span>';
                    btn.disabled = false;
                }
            });

            // Download function
            window.downloadAnalyse = function() {
                if (!generatedAnalyse) return;
                
                const element = document.createElement('a');
                const file = new Blob([generatedAnalyse], {type: 'text/plain'});
                element.href = URL.createObjectURL(file);
                element.download = `bedriftsanalyse_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);
            };

            // Email function
            window.emailAnalyse = function() {
                if (!generatedAnalyse) return;
                
                const subject = encodeURIComponent('Generert bedriftsanalyse fra AIKI AI');
                const body = encodeURIComponent(generatedAnalyse);
                window.open(`mailto:?subject=${subject}&body=${body}`);
            };

            AIKI.logger.success('🏢 AIKI Bedriftsanalyse er klar!');
        });
    </script>
</body>
</html> 